{% extends 'app/base.html' %}

{% block title %}Chat{% endblock %}

{% block content %}
<div class="chat-container" style="max-width: 700px; margin: 20px auto; border: 1px solid #333; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; height: 500px; background-color: #000;">

    <div id="chat-box" style="flex: 1; padding: 15px; overflow-y: auto; background-color: #111; color: #fff;">
        {% for message in messages %}
            <p style="margin: 5px 0;">
                <strong style="color: #00bfff;">{{ message.sender.username }}:</strong> {{ message.content }}
            </p>
        {% endfor %}
    </div>

    <form method="post" style="display: flex; border-top: 1px solid #333; padding: 10px; background-color: #111;">
        {% csrf_token %}
        {{ form.content }}
        <button type="submit" style="margin-left: 10px; padding: 5px 15px; background-color: #00bfff; color: black; border: none; border-radius: 4px; cursor: pointer;">
            Send
        </button>
    </form>
</div>

<script>
const chatId = {{ chat.id }};
function fetchMessages() {
    fetch(`/chat/${chatId}/json/`)
        .then(response => response.json())
        .then(data => {
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML = '';
            data.messages.forEach(msg => {
                chatBox.innerHTML += `<p style="margin:5px 0;"><strong style="color:#00bfff;">${msg.sender}:</strong> ${msg.content}</p>`;
            });
            chatBox.scrollTop = chatBox.scrollHeight; // автопрокрутка вниз
        });
}

// Оновлювати кожні 2 секунди
setInterval(fetchMessages, 2000);
</script>
{% endblock %}
