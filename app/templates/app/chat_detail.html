<div id="chat-box">
  {% for message in messages %}
    <p><strong>{{ message.sender.username }}:</strong> {{ message.content }}</p>
  {% endfor %}
</div>

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Send</button>
</form>

<script>
const chatId = {{ chat.id }};
function fetchMessages() {
    fetch(`/chat/${chatId}/json/`)
        .then(response => response.json())
        .then(data => {
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML = '';
            data.messages.forEach(msg => {
                chatBox.innerHTML += `<p><strong>${msg.sender}:</strong> ${msg.content}</p>`;
            });
            chatBox.scrollTop = chatBox.scrollHeight; // автопрокрутка вниз
        });
}

// Оновлювати кожні 2 секунди
setInterval(fetchMessages, 2000);
</script>
